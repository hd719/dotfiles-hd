#### Setting up tmux ####
# 1. Copy over the tmux.conf file from dotfiles into ~/.config/tmux
# 2. Create plugins folder in tmux and clone 2 repositories
#   2a. create a folder in tmux/plugins/catppuccin and clone this repo git@github.com:hd719/hd-tmux.git
#   2b. clone tpm https://github.com/tmux-plugins/tpm
# 3. Install plugs (escape + shift + i)
#########################

#####################
# PREFIX & KEY BINDINGS
#####################

# Unbind the default prefix (Ctrl-b) and use Escape instead
unbind C-b
set -g prefix Escape

# Reload config
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded"

# Split panes
bind s split-window -v -c "#{pane_current_path}"
bind v split-window -h -c "#{pane_current_path}"

# Copy mode
bind-key '[' copy-mode
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection

#####################
# GENERAL SETTINGS
#####################

set -g status-interval 5           # Update status bar every 5 seconds (default is 15)
set -g base-index 1                # Start window numbering at 1
set -g pane-base-index 1           # Start pane numbering at 1
set -g renumber-windows on         # Renumber windows when any window is closed
set -g escape-time 0               # Immediate key response after Escape
set -g mouse on                    # Enable mouse support
set -g history-limit 2147483647    # Maximum history size (effectively unlimited)
set -g set-clipboard on            # Use system clipboard
set -g status-position top         # Set status bar position to top
setw -g mode-keys vi               # Use vi key bindings in copy mode

#####################
# TERMINAL SETTINGS
#####################

set -g default-terminal "xterm-256color"
set-option -ga terminal-overrides ",xterm-256color:Tc"

#####################
# PLUGINS
#####################

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-cpu'
# Disabled for faster startup - uncomment if needed
# set -g @plugin 'dreknix/tmux-primary-ip'
# set -g @plugin '0xAF/tmux-public-ip'

# Plugin settings
set -g @yank_action 'copy-pipe'
set -g @yank-clipboard "on"
# Public IP settings (plugin disabled for faster startup)
# set -g @public_ip_dir '~/.config/tmux'
# set -g @public_ip_tmp_file 'tmux-pip.json'
# set -g @public_ip_json_url 'https://ipinfo.io/json'
# set -g @public_ip_refresh '120'

#####################
# CATPPUCCIN THEME
#####################

set -g @catppuccin_flavor "mocha"
set -g @catppuccin_window_status_style "basic"
set -g @catppuccin_date_time_text " %m-%d %H:%M"

# Set status module background to match terminal background
set -g @catppuccin_status_module_bg_color "#282a36"

# Load Catppuccin theme
run ~/.config/tmux/plugins/catppuccin/hd-tmux/catppuccin.tmux

#####################
# STATUS BAR
#####################

# Status bar transparency
set -g status-bg default
set -g status-style bg=default,fg=default

# Window status formatting
set -g window-status-separator " "
set -g status-left ""
set -g window-status-format "#[fg=#a6e3a1,bg=#282a36]#I "
set -g window-status-current-format "#[fg=#b4befe,bg=#282a36]#I "

# Status right modules
set -g status-right-length 10000
set -g status-right "#{E:@catppuccin_status_application}"
# set -ag status-right "#($HOME/.config/tmux/scripts/cal.sh)"  # Disabled - file doesn't exist
set -ag status-right "#{E:@catppuccin_status_session}"
set -agF status-right "#{E:@catppuccin_status_cpu}"

# Memory pressure module
set -ag status-right "#[bg=#{@thm_blue},fg=#{@thm_crust}]#[reverse]█#[noreverse]  "
set -ag status-right "#[fg=#{@thm_fg},bg=#282a36] #($HOME/.config/tmux/scripts/cached-memory.sh) "

# Docker context module
set -ag status-right "#[bg=#74c7ec,fg=#{@thm_crust}]#[reverse]█#[noreverse] "
set -ag status-right "#[fg=#{@thm_fg},bg=#282a36] #($HOME/.config/tmux/scripts/cached-docker-context.sh) "

# Kubernetes context module
set -ag status-right "#[bg=#b4befe,fg=#{@thm_crust}]#[reverse]█#[noreverse]󱃾 "
set -ag status-right "#[fg=#{@thm_fg},bg=#282a36] #($HOME/.config/tmux/scripts/cached-k8s-context.sh) "

# AWS profile module
set -ag status-right "#[bg=#fab387,fg=#{@thm_crust}]#[reverse]█#[noreverse] "
set -ag status-right "#[fg=#{@thm_fg},bg=#282a36] #($HOME/.config/tmux/scripts/cached-aws-profile.sh) "

#####################
# INITIALIZE TPM (keep at bottom)
#####################

run '~/.config/tmux/plugins/tpm/tpm'
